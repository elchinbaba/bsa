(this["webpackJsonpbinary-studio-academy-client"]=this["webpackJsonpbinary-studio-academy-client"]||[]).push([[21],{1975:function(e,t,s){},1976:function(e,t,s){},1977:function(e,t,s){},1978:function(e,t,s){},1979:function(e,t,s){},1980:function(e,t,s){},1981:function(e,t,s){},554:function(e,t,s){"use strict";s.d(t,"a",(function(){return o}));var a=s(2),n=(s(0),s(86)),i=s(128),o=(s(636),function(e){var t=e.handleClose,s=e.textIntlId,o=e.text,c=e.show,r=e.height,l=e.width,d=e.onConfirm,u=e.type,m=void 0===u?"info":u,h=e.localizationValues,g=e.additionalContent,p=void 0===g?null:g,f=e.disableSubmitButton,j=void 0!==f&&f,v=s||(o||"default message"),b="confirmation-modal"+(m?" confirmation-modal--".concat(m):"");return c?Object(a.jsx)("div",{className:"confirmation-modal-wrapper",children:Object(a.jsxs)("div",{style:{height:null!==r&&void 0!==r?r:p?"max-content":void 0,width:l},className:b,children:[Object(a.jsxs)("div",{className:"confirmation-modal__content",style:p?{overflow:"visible"}:{},children:[Object(a.jsx)(n.a,{id:v,defaultMessage:o,values:h}),Object(a.jsx)("div",{children:p})]}),Object(a.jsxs)("div",{className:"confirmation-modal__actions",children:[Object(a.jsx)(i.a,{className:"confirmation-modal__cancel",textIntlId:"cancel",onClick:t}),Object(a.jsx)(i.a,{className:"confirmation-modal__confirm",text:"Ok",onClick:d,disabled:j})]})]})}):null})},566:function(e,t,s){"use strict";s.d(t,"a",(function(){return l}));var a=s(0);function n(){return(n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var a in s)Object.prototype.hasOwnProperty.call(s,a)&&(e[a]=s[a])}return e}).apply(this,arguments)}function i(e,t){if(null==e)return{};var s,a,n=function(e,t){if(null==e)return{};var s,a,n={},i=Object.keys(e);for(a=0;a<i.length;a++)s=i[a],t.indexOf(s)>=0||(n[s]=e[s]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)s=i[a],t.indexOf(s)>=0||Object.prototype.propertyIsEnumerable.call(e,s)&&(n[s]=e[s])}return n}var o=a.createElement("g",{clipPath:"url(#clip0_602:1040)"},a.createElement("path",{d:"M15.8125 21.9982H2.52089C1.13028 21.9982 0 20.8679 0 19.4773V6.18568C0 4.79507 1.13028 3.66479 2.52089 3.66479H10.3125C10.692 3.66479 11 3.97279 11 4.35229C11 4.7318 10.692 5.03979 10.3125 5.03979H2.52089C1.88928 5.03979 1.375 5.55408 1.375 6.18568V19.4773C1.375 20.1089 1.88928 20.6232 2.52089 20.6232H15.8125C16.4441 20.6232 16.9584 20.1089 16.9584 19.4773V11.6857C16.9584 11.3062 17.2664 10.9982 17.6459 10.9982C18.0254 10.9982 18.3334 11.3053 18.3334 11.6857V19.4773C18.3334 20.8679 17.2031 21.9982 15.8125 21.9982Z",fill:"#00AEEF"}),a.createElement("path",{d:"M8.04114 14.6442C7.86054 14.6442 7.68447 14.5727 7.55523 14.4426C7.39208 14.2803 7.32242 14.0465 7.36741 13.8219L8.01546 10.5806C8.04198 10.4468 8.10795 10.3248 8.20328 10.2295L17.6974 0.736568C18.6799 -0.246174 20.2787 -0.246174 21.2623 0.736568C21.7379 1.21225 22.0001 1.84486 22.0001 2.5186C22.0001 3.19233 21.7379 3.82478 21.2613 4.30062L11.7683 13.7945C11.673 13.8907 11.5501 13.9558 11.4172 13.9824L8.17676 14.6304C8.13178 14.6396 8.08596 14.6442 8.04114 14.6442ZM11.2824 13.3086H11.2917H11.2824ZM9.32265 11.0546L8.91831 13.0803L10.9432 12.6752L20.2896 3.32896C20.5059 3.1116 20.6251 2.82475 20.6251 2.5186C20.6251 2.21244 20.5059 1.92543 20.2896 1.70823C19.8441 1.26176 19.1172 1.26176 18.669 1.70823L9.32265 11.0546Z",fill:"#00AEEF"}),a.createElement("path",{d:"M19.4793 5.79971C19.3034 5.79971 19.1273 5.73274 18.9935 5.59796L16.4011 3.00473C16.1326 2.73618 16.1326 2.30078 16.4011 2.03223C16.6697 1.76367 17.1051 1.76367 17.3738 2.03223L19.966 4.62546C20.2346 4.89401 20.2346 5.32941 19.966 5.59796C19.8312 5.7319 19.6553 5.79971 19.4793 5.79971Z",fill:"#00AEEF"})),c=a.createElement("defs",null,a.createElement("clipPath",{id:"clip0_602:1040"},a.createElement("rect",{width:22,height:22,fill:"white"})));function r(e,t){var s=e.title,r=e.titleId,l=i(e,["title","titleId"]);return a.createElement("svg",n({width:22,height:22,viewBox:"0 0 22 22",fill:"none",ref:t,"aria-labelledby":r},l),s?a.createElement("title",{id:r},s):null,o,c)}var l=a.forwardRef(r);s.p},578:function(e,t,s){"use strict";s.d(t,"a",(function(){return u}));var a=s(0);function n(){return(n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var a in s)Object.prototype.hasOwnProperty.call(s,a)&&(e[a]=s[a])}return e}).apply(this,arguments)}function i(e,t){if(null==e)return{};var s,a,n=function(e,t){if(null==e)return{};var s,a,n={},i=Object.keys(e);for(a=0;a<i.length;a++)s=i[a],t.indexOf(s)>=0||(n[s]=e[s]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)s=i[a],t.indexOf(s)>=0||Object.prototype.propertyIsEnumerable.call(e,s)&&(n[s]=e[s])}return n}var o=a.createElement("path",{d:"M15.7344 2.375H12.4688V1.78125C12.4688 0.799076 11.6697 0 10.6875 0H8.3125C7.33033 0 6.53125 0.799076 6.53125 1.78125V2.375H3.26562C2.44714 2.375 1.78125 3.04089 1.78125 3.85938V5.9375C1.78125 6.2654 2.0471 6.53125 2.375 6.53125H2.69948L3.21245 17.3035C3.25776 18.2548 4.03928 19 4.99166 19H14.0083C14.9608 19 15.7423 18.2548 15.7876 17.3035L16.3005 6.53125H16.625C16.9529 6.53125 17.2188 6.2654 17.2188 5.9375V3.85938C17.2188 3.04089 16.5529 2.375 15.7344 2.375ZM7.71875 1.78125C7.71875 1.45387 7.98512 1.1875 8.3125 1.1875H10.6875C11.0149 1.1875 11.2812 1.45387 11.2812 1.78125V2.375H7.71875V1.78125ZM2.96875 3.85938C2.96875 3.69569 3.10194 3.5625 3.26562 3.5625H15.7344C15.8981 3.5625 16.0312 3.69569 16.0312 3.85938V5.34375C15.8483 5.34375 3.72701 5.34375 2.96875 5.34375V3.85938ZM14.6014 17.247C14.5863 17.5641 14.3258 17.8125 14.0083 17.8125H4.99166C4.67419 17.8125 4.41368 17.5641 4.39861 17.247L3.88832 6.53125H15.1117L14.6014 17.247Z",fill:"#00AEEF"}),c=a.createElement("path",{d:"M9.5 16.625C9.8279 16.625 10.0938 16.3591 10.0938 16.0312V8.3125C10.0938 7.9846 9.8279 7.71875 9.5 7.71875C9.1721 7.71875 8.90625 7.9846 8.90625 8.3125V16.0312C8.90625 16.3591 9.17206 16.625 9.5 16.625Z",fill:"#00AEEF"}),r=a.createElement("path",{d:"M12.4688 16.625C12.7966 16.625 13.0625 16.3591 13.0625 16.0312V8.3125C13.0625 7.9846 12.7966 7.71875 12.4688 7.71875C12.1409 7.71875 11.875 7.9846 11.875 8.3125V16.0312C11.875 16.3591 12.1408 16.625 12.4688 16.625Z",fill:"#00AEEF"}),l=a.createElement("path",{d:"M6.53125 16.625C6.85915 16.625 7.125 16.3591 7.125 16.0312V8.3125C7.125 7.9846 6.85915 7.71875 6.53125 7.71875C6.20335 7.71875 5.9375 7.9846 5.9375 8.3125V16.0312C5.9375 16.3591 6.20331 16.625 6.53125 16.625Z",fill:"#00AEEF"});function d(e,t){var s=e.title,d=e.titleId,u=i(e,["title","titleId"]);return a.createElement("svg",n({width:19,height:19,viewBox:"0 0 19 19",fill:"none",ref:t,"aria-labelledby":d},u),s?a.createElement("title",{id:d},s):null,o,c,r,l)}var u=a.forwardRef(d);s.p},593:function(e,t,s){"use strict";var a=s(59),n=s(2),i=s(0),o=s(631),c=s(65),r=s(201),l=(s(618),{content:"",mcePlugins:"print preview searchreplace autolink directionality visualblocks visualchars fullscreen paste image link media template codesample table charmap hr pagebreak nonbreaking anchor toc insertdatetime advlist lists textcolor wordcount imagetools contextmenu colorpicker textpattern help emoticons autoresize",toolbarOptions:"fullscreen | formatselect | bold italic strikethrough forecolor tinymcespellcheckerbackcolor | link | alignleft aligncenter alignright alignjustify  | numlist bullist outdent indent  | removeformat | emoticons | codesample"});t.a=function(e){var t=e.handleTextChange,s=e.letterText,d=e.templateText,u=e.onInit,m=e.disabled,h=void 0!==m&&m,g=e.inline,p=void 0!==g&&g,f=e.hideMenuBar,j=void 0!==f&&f,v=e.onFocusIn,b=e.onFocusOut,C=e.onKeyDown,O=e.actionOnSetup,M=e.customToolbarOptions,x=e.height,E=Object(i.useState)(null),w=Object(a.a)(E,2),I=w[0],k=w[1];return i.useEffect((function(){I&&d&&I.setContent(d)}),[d,I]),Object(n.jsx)(o.a,{apiKey:c.a.tinyMceApiKey,initialValue:s,value:s,onInit:u,onFocusIn:v,onFocusOut:b,disabled:h,inline:p,init:{setup:function(e){k(e),Object(r.b)(O)||O(e),e.on("keydown",C)},menubar:!j,height:x||200,plugins:l.mcePlugins,toolbar1:null!==M&&void 0!==M?M:l.toolbarOptions,toolbar_mode:"scrolling",image_advtab:!0,branding:!1,statusbar:!1,paste_data_images:!0,paste_preprocess:function(e,t){if(/"(.+)"/.exec(t.content)){var s=/"(.+)"/.exec(t.content)[1];!function(e,t){var a=new Image;a.src=s,a.onload=function(){var e=document.createElement("canvas");e.width=a.width,e.height=a.height,e.getContext("2d").drawImage(a,0,0);var s=e.toDataURL("image/jpg").replace(/^data:image\/(png|jpg);base64,/,"");t(s)},a.setAttribute("crossOrigin","anonymous"),a.src=e}(s,(function(e){var s=atob(e);Math.round(3*s.length/4)/1024/1024>2&&(t.content="")}))}},font_formats:"Gilroy Medium=Gilroy-Medium;",theme_advanced_fonts:"Gilroy Medium=GilroyMedium;",templates:[{title:"Template 1",content:"Temp 1"},{title:"Template 2",content:"Temp 2"}],content_css:["//fonts.googleapis.com/css?family=Lato:300,300i,400,400i","//www.tinymce.com/css/codepen.min.css","/study.binary-studio.com/Fonts/Gilroy-Medium.woff"],invalid_elements:"div",browser_spellcheck:!0},onEditorChange:t})}},610:function(e,t,s){"use strict";var a=s(2),n=(s(0),s(244));s(769);t.a=function(e){var t=e.avatarUrl,s=e.firstName,i=e.lastName;return Object(a.jsx)("div",{className:"round-avatar-wrp",children:Object(a.jsx)(n.a,{classNames:["round-avatar"],imgUrl:t,firstName:s,lastName:i})})}},618:function(e,t,s){},636:function(e,t,s){},769:function(e,t,s){},879:function(e,t,s){"use strict";s.r(t);var a=s(4),n=s.n(a),i=s(159),o=s(28),c=s(37),r=s(8),l=s(9),d=s(20),u=s(21),m=s(2),h=s(0),g=s(84),p=s.n(g),f=s(86),j=s(47),v=s(31),b=s(30),C=s(35),O=s.n(C),M=(s(1971),s(1972),s(1973),s(87)),x=s(129),E=(s(1974),s(1975),s(276)),w=s(204),I=s(1136),k=(s(1976),s(557)),S=s(128),y=function(e){Object(d.a)(s,e);var t=Object(u.a)(s);function s(e){var a;return Object(r.a)(this,s),(a=t.call(this,e)).onSaveMessage=function(){return a.props.onSubmit(a.state.code,a.state.message)},a.state={message:e.message,code:e.code||""},a}return Object(l.a)(s,[{key:"render",value:function(){var e=this,t=this.state,s=t.code,a=t.message,n=this.props.code;return Object(m.jsxs)("div",{className:"code-modal",children:[Object(m.jsx)(I.UnControlled,{className:"code-editor",editorDidMount:function(e){return e.focus()},options:{lineNumbers:!0,lineWrapping:!0,autoRefresh:!0},onChange:function(t,s,a){return e.setState({code:a})}}),!n&&Object(m.jsx)(k.a,{className:"code-snippet-message",value:a,onChange:function(t){var s=t.target;return e.setState({message:s.value})},placeholderIntlId:"chatPlaceholder"}),Object(m.jsx)(S.a,{className:"code-snippet-btn",textIntlId:n?"Save":"userCabinet.send",onClick:this.onSaveMessage,disabled:!s})]})}}]),s}(h.Component),N=s(593),A=function(e){Object(d.a)(s,e);var t=Object(u.a)(s);function s(e){var a;return Object(r.a)(this,s),(a=t.call(this,e)).fileInputRef=null,a.onKeyDown=function(e){e.keyCode===E.a.ENTER?e.ctrlKey||e.shiftKey||(e.preventDefault(),e.stopPropagation(),a.props.submitDisabled||a.props.onSubmit()):e.keyCode===E.a.ESCAPE&&a.props.isEditing&&a.props.onEditCancel()},a.toggleCodeModal=function(e){return a.setState({isCodeModalShown:e})},a.toggleTextAreaFocus=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;a.setState((function(t){return{textAreaFocused:null!==e&&void 0!==e?e:t.textAreaFocused}}))},a.onEditCodeCancel=function(){a.toggleCodeModal(!1),a.props.onEditCodeCancel()},a.onSaveCodeSnippet=function(e,t){a.toggleCodeModal(!1),a.props.editingCode?a.props.onSaveCodeSnippet(e):a.props.onSubmit(e,t)},a.handlePasteEvent=function(e){a.props.attachmentsLimitExceeded||a.props.onFilesAttached(Object(o.a)(e.clipboardData.files))},a.handleFileInputChange=function(e){a.props.attachmentsLimitExceeded||a.props.onFilesAttached(Object(o.a)(e.target.files))},a.handleUploadFileClick=function(){a.fileInputRef.value=null,a.fileInputRef.click()},a.handleMessageChange=function(e){return a.props.onMessageChange(e)},a.state={isCodeModalShown:!1,textAreaFocused:!1,isMobile:window.innerWidth<800},a}return Object(l.a)(s,[{key:"componentDidMount",value:function(){document.addEventListener("paste",this.handlePasteEvent)}},{key:"componentWillUnmount",value:function(){document.removeEventListener("paste",this.handlePasteEvent)}},{key:"componentDidUpdate",value:function(e){this.props.editingCode&&e.editingCode!==this.props.editingCode&&this.setState({isCodeModalShown:!0})}},{key:"renderMobileView",value:function(){var e=this,t=this.props,s=t.message,a=t.actionsAllowed,n=t.isEditing,i=t.onSubmit;return Object(m.jsx)(m.Fragment,{children:Object(m.jsxs)("div",{className:"mobile-chat-input-block",children:[Object(m.jsx)(k.a,{onChange:function(t){return e.handleMessageChange(t.target.value)},value:s,readOnly:!a}),Object(m.jsx)(M.a,{icon:n?x.e:x.o,onClick:function(){return i()}})]})})}},{key:"render",value:function(){var e=this,t=this.props,s=t.message,a=t.isEditing,n=t.onEditCancel,i=t.actionsAllowed,o=t.editingCode,c=t.inputHeight,r=this.state,l=r.textAreaFocused;return r.isMobile?this.renderMobileView():Object(m.jsxs)(m.Fragment,{children:[Object(m.jsxs)("div",{className:"message-title",children:[Object(m.jsx)("span",{className:"title",children:a?Object(m.jsx)(f.a,{id:"editMessage",defaultMessage:"Edit message"}):Object(m.jsx)(f.a,{id:"message",defaultMessage:"Message"})}),Object(m.jsx)("span",{className:"additional-details",children:a?Object(m.jsxs)(m.Fragment,{children:[Object(m.jsx)("span",{className:"cancel-editing",onClick:n,role:"presentation",children:Object(m.jsx)(f.a,{id:"cancel"})})," (",Object(m.jsx)(f.a,{id:"or"})," esc)"]}):Object(m.jsx)(f.a,{id:"messageDetails",defaultMessage:"(Enter - send)"})})]}),Object(m.jsx)("div",{className:"message-input-form",children:Object(m.jsxs)("div",{className:"message-input-form-field ".concat(l?"active":""),children:[Object(m.jsx)(N.a,{handleTextChange:this.handleMessageChange,letterText:s,disabled:!i,onKeyDown:this.onKeyDown,onFocusIn:function(){return e.toggleTextAreaFocus(!0)},onFocusOut:function(){return e.toggleTextAreaFocus(!1)},hideMenuBar:!0,customToolbarOptions:"formatselect | bold italic strikethrough forecolor tinymcespellcheckerbackcolor | removeformat | link | alignleft aligncenter alignright alignjustify  | numlist bullist outdent indent | emoticons | codesample",height:c}),Object(m.jsxs)("div",{className:"chat-buttons",children:[Object(m.jsxs)("div",{className:"chat-buttons-tools",children:[!a&&Object(m.jsxs)("div",{className:"code-container",title:"Code input",children:[Object(m.jsx)(M.a,{icon:x.i,onClick:function(){return e.toggleCodeModal(!0)}}),this.state.isCodeModalShown&&Object(m.jsx)(w.a,{className:"code-snippet-modal",show:this.state.isCodeModalShown,handleClose:function(){return o?e.toggleCodeModal(!1):e.onEditCodeCancel()},children:Object(m.jsx)(y,{code:o,message:s,onSubmit:this.onSaveCodeSnippet})})]}),Object(m.jsxs)("div",{className:"attach-image",title:"Image input",children:[Object(m.jsx)("input",{type:"file",className:"file-input",ref:function(t){return e.fileInputRef=t},onChange:this.handleFileInputChange,accept:"image/jpeg, image/jpg, image/png"}),Object(m.jsx)(M.a,{icon:x.m,onClick:!this.props.attachmentsLimitExceeded&&this.handleUploadFileClick,className:this.props.attachmentsLimitExceeded?"disabled":""})]})]}),Object(m.jsx)(M.a,{title:"Send",className:O()("chat-send-button",{disabled:this.props.submitDisabled}),icon:a?x.e:x.o,onClick:function(){return e.props.onSubmit()}})]})]})})]})}}]),s}(h.PureComponent),T=s(59),L=s(5),R=s(610),F=s(578),H=s(566),_=(s(1977),s(1978),function(e){var t=e.attachment,s=e.onClick,a=e.icon;return Object(m.jsxs)("div",{className:"attachment-item",onClick:function(e){e.stopPropagation(),s&&s(t)},children:[Object(m.jsx)("img",{className:"attachment-item__preview",src:t.previewUrl,alt:""}),Object(m.jsx)("div",{className:"attachment-item__overlay",children:Object(m.jsx)(M.a,{className:"attachment-item__view",icon:a,size:"2x",color:"white"})})]})}),U=s(201),V=s(554),D=s(553),P=function(e){var t=e.message,s=e.time,a=e.firstName,n=e.lastName,i=e.avatarUrl,o=e.isStudent,c=e.isRead,r=e.onDelete,l=e.isOwn,d=e.onEdit,u=e.isEditing,g=e.changeMessageStatus,j=e.code,v=e.onEditCode,b=e.id,C=e.canReadMessage,E=e.attachments,w=e.onAttachmentViewClick,k=e.status,S=e.readonlyMode,y=e.editedAt,N=Object(h.useState)(!0),A=Object(T.a)(N,2),P=A[0],Z=A[1],K=Object(h.useState)(!1),Q=Object(T.a)(K,2),B=Q[0],W=Q[1],G=Object(h.useState)(!1),z=Object(T.a)(G,2),J=z[0],q=z[1],Y=Object(h.useRef)(null);Object(h.useEffect)((function(){var e,t;W((null===(e=Y.current)||void 0===e?void 0:e.offsetHeight)<(null===(t=Y.current)||void 0===t?void 0:t.scrollHeight))}),[Y,b]);var X=!1,$=c?function(){!c||l||S||g([b],!1)}:null,ee=c?null:function(){c||X||l||!C||S||g([b],!0),X=!0},te=p.a.utc(s).toDate(),se=p()(te).local().format("HH:mm"),ae=Object(U.b)(y)?"":p()(y).local().format("HH:mm");return Object(m.jsxs)("div",{className:"chat-message",children:[Object(m.jsx)(R.a,{isStudent:o,avatarUrl:i,firstName:a,lastName:n}),Object(m.jsxs)("div",{className:O()("chat-message-text",{"is-read":c,"is-editing":u,"is-failed":k===L.LectureMessageStatus.Failed}),onMouseEnter:ee,onClick:$,onMouseLeave:function(){X=!1},children:[Object(m.jsxs)("div",{className:"chat-message-text-header",children:[Object(m.jsx)("span",{children:"".concat(a," ").concat(n)}),Object(m.jsx)("span",{children:se})]}),t&&Object(m.jsx)("div",{className:O()("chat-message-text-content",{own:l}),children:Object(m.jsx)(D.a,{source:t,className:"markdown-preview",escapeHtml:!1})}),j&&Object(m.jsxs)("div",{ref:Y,className:"code-block-container",style:{height:P?"5rem":"auto"},children:[Object(m.jsx)(I.UnControlled,{className:"code-block",value:j,options:{lineNumbers:!0,lineWrapping:!0,autoRefresh:!0,readOnly:!0,scrollbarStyle:"null"}}),Object(m.jsxs)("div",{children:[B&&Object(m.jsx)("div",{className:"code-block-bttn",onClick:function(){return Z(!P)},children:Object(m.jsx)(M.a,{icon:P?x.f:x.h})}),l&&v&&Object(m.jsx)("div",{onClick:v,className:"code-block-bttn",children:Object(m.jsx)(M.a,{icon:x.p})})]})]}),Object(m.jsx)("div",{className:"chat-message__attachments",children:E.map((function(e,t){return Object(m.jsx)(_,{attachment:e,onClick:w,icon:x.s},t)}))}),o&&!l&&!c&&!S&&Object(m.jsx)("div",{className:"chat-message-read",children:Object(m.jsx)("button",{className:"button",onClick:function(e){g([b],!0),e.stopPropagation()},children:Object(m.jsx)(f.a,{id:"noAnswerNeeded",defaultMessage:"No answer needed"})})}),l&&Object(m.jsxs)("div",{className:"chat-message-actions",children:[Object(m.jsx)(V.a,{show:J,handleClose:function(){return q(!1)},onConfirm:function(){q(!1),r()},text:"Are you sure you want to delete this message?",textIntlId:"messageDelete"}),Object(m.jsx)("span",{children:ae?Object(m.jsxs)(m.Fragment,{children:[Object(m.jsx)(f.a,{id:"edited"})," (".concat(ae,")")]}):Object(m.jsx)(f.a,{id:"lecture-message-status-".concat(k),defaultMessage:k})}),Object(m.jsxs)("div",{className:"chat-message-actions-controls",children:[r&&Object(m.jsx)(F.a,{className:"delete-icon",onClick:function(){return q(!0)}}),d&&Object(m.jsx)(H.a,{className:"edit-icon",onClick:d})]})]})]})]})},Z=s(49),K=(s(1979),s(157));function Q(e){return"".concat(e.userId,"_").concat(e.stageLectureId)}var B=s(102),W=s(202),G=s(23),z=(s(1980),function(e){var t=e.attachment,s=e.show,a=e.onClose;return Object(m.jsx)(w.a,{show:s,handleClose:a,className:"attachment-view-modal",children:Object(m.jsx)("div",{className:"attachment-view",children:Object(m.jsx)("img",{src:t.url,className:"attachment-view__image",alt:""})})})}),J=(s(1981),function(e){var t=e.file,s=Object(h.useState)(""),a=Object(T.a)(s,2),n=a[0],i=a[1];return Object(h.useEffect)((function(){var e=new FileReader;e.onloadend=function(){i(String(e.result))},e.readAsDataURL(t)}),[t]),Object(m.jsxs)("div",{className:"attachment-uploading-item",children:[n&&Object(m.jsx)("img",{className:"attachment-uploading-item__preview",src:n,alt:""}),Object(m.jsx)("div",{className:"attachment-uploading-item__overlay",children:Object(m.jsx)(M.a,{icon:x.v,size:"2x",spin:!0,pulse:!0})})]})}),q=s(541),Y=s(260),X=s(16),$=s(12),ee=function(e){Object(d.a)(s,e);var t=Object(u.a)(s);function s(e){var a;return Object(r.a)(this,s),(a=t.call(this,e)).state={currentMessageId:null,codeEditingMessage:null,attachmentViewModalOpen:!1,currentAttachment:null,filesQueue:[],showConnectionErrorTask:null,lastMessage:null,isMobile:window.innerWidth<800},a.messagesEnd=h.createRef(),a.getTempMessages=function(){var e=G.a.getObject(K.a.CHAT_TEMP);return e&&e.length?new Map(e):new Map},a.storeMessageAsTemp=function(){var e=a.props,t=e.userId,s=e.stageLectureId,n=e.message;if(!a.state.currentMessageId){var i=a.getTempMessages(),o=Q({userId:t,stageLectureId:s}),c=i.get(o);(n.trim()||c)&&(i.set(o,n),G.a.setMap(K.a.CHAT_TEMP,i))}},a.removeTempMessage=function(){var e=a.props,t=e.stageLectureId,s=Q({userId:e.userId,stageLectureId:t}),n=a.getTempMessages();n.delete(s),G.a.setMap(K.a.CHAT_TEMP,n)},a.removeTempMessageOnUpdate=function(){var e=a.state.lastMessage,t=a.props.messages,s=Object(v.last)(t);(function(e,t){return(null===e||void 0===e?void 0:e.id)!==(null===t||void 0===t?void 0:t.id)&&(null===t||void 0===t?void 0:t.status)===L.LectureMessageStatus.Sent})(e,s)&&(a.setState({lastMessage:s}),a.removeTempMessage())},a.readAllUnreadMessages=function(){var e=a.props,t=e.messages,s=e.user,n=[];(n=s.academyRoles&&s.academyRoles.Student&&-1!==s.academyRoles.Student.indexOf(s.currentAcademyId)?t.filter((function(e){return!0!==e.isRead&&e.id&&!e.isStudent})):t.filter((function(e){return!0!==e.isRead&&e.id&&e.isStudent}))).length&&a.changeMessageStatus(n.map((function(e){return e.id})),!0)},a.onSubmitHandler=function(e,t){var s=G.a.getTokens().accessToken,n=a.props,i=n.stageLectureId,o=n.userId,c=n.message,r=n.onMessageSubmit,l=n.attachments;if(c.trim()||l.length||e){var d=+new Date,u=new Date;a.props.actions.addLectureMessage({sender:{id:a.props.user.id,firstName:a.props.user.firstName,lastName:a.props.user.lastName,avatarUrl:a.props.user.avatarUrl},stageLectureId:a.props.stageLectureId,userId:a.props.userId,message:e?t.trim():c.trim(),resources:l,time:u,edited:null,isRead:!1,tempId:d,status:a.props.activeSocket.disconnected?L.LectureMessageStatus.Failed:L.LectureMessageStatus.Sending}),a.props.actions.sendLectureMessage({tempId:d,token:s,userId:o,stageLectureId:i,message:e?t:c,code:e,resourceIds:l.map((function(e){return e.id})),createdAt:u}),a.readAllUnreadMessages(),r()}},a.onEditCancelHandler=function(){var e=a.props,t=e.onMessageChange,s=e.onAttachmentsChange;a.setState({currentMessageId:null}),t(""),s([])},a.onEditCodeCancel=function(){return a.setState({currentCodeEditingId:null})},a.changeMessageStatus=function(e,t){var s=a.props,n=s.user,i=s.messages,o=e;(o=n.academyRoles&&n.academyRoles.Student&&-1!==n.academyRoles.Student.indexOf(n.currentAcademyId)?o.filter((function(e){return i.find((function(t){return t.id===e&&!t.isStudent}))})):o.filter((function(e){return i.some((function(t){return t.id===e&&t.isStudent}))}))).length&&a.props.actions.changeMessageStatus({messageIds:o,status:t})},a.scrollToEnd=function(){a.messagesEnd&&a.messagesEnd.current&&(a.messagesEnd.current.scrollTop=a.messagesEnd.current.scrollHeight)},a.messageDeleteHandle=function(e){return function(){var t=a.props,s=t.stageLectureId,n=t.userId,i=G.a.getTokens().accessToken;a.props.actions.deleteMessage({token:i,stageLectureId:s,userId:n,messageId:e})}},a.messageEditHandle=function(e){return function(){a.props.onMessageChange(e.message),a.props.onAttachmentsChange(e.resources),a.setState({currentMessageId:e.id})}},a.messageCodeEditHandle=function(e){return function(){return a.setState({codeEditingMessage:e})}},a.messageSaveHandle=function(){var e=a.props,t=e.message,s=e.stageLectureId,n=e.userId,i=e.onMessageSubmit,o=e.messages,c=e.attachments,r=a.state.currentMessageId,l=G.a.getTokens().accessToken,d=o.find((function(e){return e.id===r})).code||"";(t.trim()||d||c.length)&&(a.props.actions.updateMessage({token:l,messageId:r,message:t.trim(),code:d,stageLectureId:s,userId:n,resourceIds:c.map((function(e){return e.id}))}),a.readAllUnreadMessages(),a.setState({currentMessageId:null}),i())},a.messageCodeSaveHandle=function(e){var t=a.props,s=t.stageLectureId,n=t.userId,i=a.state.codeEditingMessage,o=G.a.getTokens().accessToken;a.props.actions.updateMessage({token:o,messageId:i.id,message:i.message,stageLectureId:s,userId:n,code:e,resourceIds:i.resources.map((function(e){return e.id}))}),a.setState({codeEditingMessage:null})},a.handleAttachmentViewClick=function(e){a.setState({currentAttachment:e,attachmentViewModalOpen:!0})},a.handleAttachmentViewModalClose=function(){a.setState({attachmentViewModalOpen:!1})},a.canReadMessage=function(){var e=a.props,t=e.homeworkResponse,s=e.currentUserId,n=e.user;return Object(W.b)(n,[L.RoleName.Student],n.currentAcademyId)||t&&t.reviewer&&t.reviewer.id===s},a.handleAttachedFiles=function(){var e=Object(c.a)(n.a.mark((function e(t){var s,c,r,l;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:s=t.map((function(e){return Object.assign(e,{uuid:Object(q.a)()})})),a.setState({filesQueue:[].concat(Object(o.a)(a.state.filesQueue),Object(o.a)(s))}),c=Object(i.a)(s),e.prev=3,l=n.a.mark((function e(){var t,s,i,c;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.value,e.prev=1,e.next=4,Y.a.uploadAttachment(t);case 4:s=e.sent,a.props.onAttachmentsChange([].concat(Object(o.a)(a.props.attachments),[s.data])),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),(null===e.t0||void 0===e.t0||null===(i=e.t0.response)||void 0===i||null===(c=i.data)||void 0===c?void 0:c.code)===L.ErrorCode.FileTypeIsNotAllowed?a.props.actions.addCommonAlert({status:$.a.error,formattedMessageId:"fileTypeIsNotAllowed",defaultMessage:"File type is not allowed"}):a.props.actions.addCommonAlert({status:$.a.error,formattedMessageId:"errorUploadingFile",defaultMessage:"Error uploading file"});case 11:return e.prev=11,a.setState({filesQueue:a.state.filesQueue.filter((function(e){return e.uuid!==t.uuid}))}),e.finish(11);case 14:case"end":return e.stop()}}),e,null,[[1,8,11,14]])})),c.s();case 6:if((r=c.n()).done){e.next=10;break}return e.delegateYield(l(),"t0",8);case 8:e.next=6;break;case 10:e.next=15;break;case 12:e.prev=12,e.t1=e.catch(3),c.e(e.t1);case 15:return e.prev=15,c.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[3,12,15,18]])})));return function(t){return e.apply(this,arguments)}}(),a.handleAttachmentDelete=function(){var e=Object(c.a)(n.a.mark((function e(t){return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a.props.onAttachmentsChange(a.props.attachments.filter((function(e){return e.id!==t.id}))),a.state.currentMessageId){e.next=4;break}return e.next=4,Y.a.deleteAttachment(t.id);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),a.attachmentsLimitExceeded=function(){var e=a.props.attachments,t=a.state.filesQueue;return e.length+t.length>=5},a.scrollToEnd(),a}return Object(l.a)(s,[{key:"componentDidMount",value:function(){var e=this,t=this.props,s=t.userId,a=t.stageLectureId,n=t.onMessageChange,i=t.actions,o=t.currentUserId,c=t.user,r=t.messages;i.joinToChatRoom({token:G.a.getTokens().accessToken,studentId:s||o||c.id,stageLectureId:a}),i.fetchMessages(a,s||o),this.props.actions.saveActivePage({name:"chat",payload:{stageLectureId:a,userId:s||o}}),this.scrollToEnd(),setTimeout((function(){return e.scrollToEnd()}),200);var l=this.getTempMessages(),d=Q({userId:s,stageLectureId:a}),u=l.get(d);u&&setTimeout((function(){n(u)}),100),window.addEventListener("beforeunload",this.storeMessageAsTemp,!1),this.props.activeSocket.addEventListener(L.SocketEventType.Reconnect,(function(){i.joinToChatRoom&&i.joinToChatRoom({token:G.a.getTokens().accessToken,studentId:s||o||c.id,stageLectureId:a}),i.fetchUnreadedMessages&&i.fetchUnreadedMessages(a,s||o||c.id),clearTimeout(e.state.showConnectionErrorTask),e.setState({showConnectionErrorTask:null,showConnectionError:!1})})),this.props.activeSocket.addEventListener(L.SocketEventType.ReconnectAttempt,(function(){if(!e.state.showConnectionError){var t=setTimeout((function(){console.error("Cannot reconnect to server...."),clearTimeout(t),e.setState({showConnectionErrorTask:null,showConnectionError:!0}),i.markFailedMessages()}),3e4);e.setState({showConnectionErrorTask:t})}})),this.props.activeSocket.on(L.SocketEventType.Disconnect,(function(){e.setState({showConnectionErrorTask:null,showConnectionError:!0}),i.markFailedMessages()}));var m=Object(v.last)(r);this.setState({lastMessage:m||null})}},{key:"componentDidUpdate",value:function(e){var t=this.props,s=t.messages,a=t.userId,n=t.actions,i=t.stageLectureId;Object(v.isEqual)(e.messages,s)||this.scrollToEnd(),a!==e.userId&&i===e.stageLectureId&&n.fetchMessages(i,a),this.removeTempMessageOnUpdate()}},{key:"componentWillUnmount",value:function(){this.props.message?this.storeMessageAsTemp():this.removeTempMessage(),this.props.onMessageChange(""),this.props.actions.saveActivePage(null),this.props.actions.leaveChatRoom({studentId:this.props.userId||this.props.currentUserId||this.props.user.id,stageLectureId:this.props.stageLectureId}),window.removeEventListener("beforeunload",this.storeMessageAsTemp,!1)}},{key:"renderMessages",value:function(e,t){var s=this,a=this.state.currentMessageId,n=this.props.readonlyMode,i=[];return e.map((function(e,o){var c,r=e.sender,l=e.message,d=e.time,u=e.isRead,h=e.id,g=e.isStudent,f=e.code,j=e.edited,v=p()(d).startOf("day").unix();-1===i.indexOf(v)&&(i.push(v),c=p()(d).format("LL"));var b=r.id===t;return Object(m.jsxs)("div",{children:[c&&Object(m.jsx)("div",{className:"date-delimeter",children:Object(m.jsx)("span",{className:"text",children:c})}),Object(m.jsx)(P,{status:e.status||L.LectureMessageStatus.Sent,isOwn:b,onDelete:s.props.userId?s.messageDeleteHandle(h):null,onEdit:s.props.userId?s.messageEditHandle(e):null,onEditCode:s.props.userId?s.messageCodeEditHandle(e):null,id:h,avatarUrl:r.avatarUrl,firstName:r.firstName,lastName:r.lastName,message:l,time:d,editedAt:j,isStudent:g,isRead:u,isEditing:h===a,code:f,canReadMessage:s.canReadMessage(),changeMessageStatus:s.changeMessageStatus,attachments:e.resources,onAttachmentViewClick:s.handleAttachmentViewClick,readonlyMode:n})]},o)}))}},{key:"render",value:function(){var e=this,t=this.props,s=t.message,a=t.onMessageChange,n=t.currentUserId,i=t.loading,o=t.messages,c=t.actionsAllowed,r=t.attachments,l=t.readonlyMode,d=t.chatInputHeight,u=this.state,h=u.currentMessageId,g=u.codeEditingMessage,p=u.showConnectionError,j=u.filesQueue;return i?Object(m.jsx)(B.a,{}):Object(m.jsx)(m.Fragment,{children:Object(m.jsxs)("div",{className:"chat",children:[l?null:Object(m.jsx)("div",{children:Object(m.jsxs)("div",{className:O()("message-input-elems",{mobile:this.state.isMobile}),children:[!this.state.isMobile&&Object(m.jsxs)("div",{className:"attachments",children:[r.map((function(t,s){return Object(m.jsx)(_,{attachment:t,onClick:e.handleAttachmentDelete,icon:x.x},s)})),j.map((function(e,t){return Object(m.jsx)(J,{file:e},t)}))]}),Object(m.jsx)(A,{message:s,onMessageChange:a,onSubmit:h?this.messageSaveHandle:this.onSubmitHandler,isEditing:Boolean(h),onEditCancel:this.onEditCancelHandler,actionsAllowed:c,submitDisabled:j.length>0,editingCode:null===g||void 0===g?void 0:g.code,onEditCodeCancel:this.onEditCodeCancel,onSaveCodeSnippet:this.messageCodeSaveHandle,onFilesAttached:this.handleAttachedFiles,attachmentsLimitExceeded:this.attachmentsLimitExceeded(),inputHeight:d}),p&&Object(m.jsx)("div",{className:"connection-error",children:Object(m.jsx)("span",{children:Object(m.jsx)(f.a,{id:"chatConnectionError",defaultMessage:"Internet problems. try to reconnect"})})})]})}),this.state.currentAttachment&&Object(m.jsx)(z,{show:this.state.attachmentViewModalOpen,onClose:this.handleAttachmentViewModalClose,attachment:this.state.currentAttachment}),Object(m.jsx)("div",{className:"chat-messages",ref:this.messagesEnd,children:this.renderMessages(o,n)})]})})}}]),s}(h.Component),te=Object(b.c)((function(e,t){return{currentUserId:e.user.id,messages:e.socket.messages.filter((function(e){return e.stageLectureId===t.stageLectureId&&(!t.userId||e.userId===t.userId)})).sort((function(e,t){return+new Date(e.time)-+new Date(t.time)})),loading:e.socket.loadingMessages,actionsAllowed:Object(W.b)(e.user,[L.RoleName.SuperAdmin,L.RoleName.Admin,L.RoleName.TrackOwner,L.RoleName.Coach,L.RoleName.Teacher,L.RoleName.Student],e.user.currentAcademyId),user:e.user,activeSocket:e.socket.activeSocket}}),(function(e){return{actions:Object(j.bindActionCreators)({addLectureMessage:Z.a.addLectureMessage,sendLectureMessage:Z.a.sendLectureMessage,changeMessageStatus:Z.a.changeMessageStatus,deleteMessage:Z.a.startDeleteMessage,updateMessage:Z.a.startUpdateMessage,fetchMessages:Z.a.fetchMessages,saveActivePage:Z.a.saveActivePage,joinToChatRoom:Z.a.joinToChatRoom,leaveChatRoom:Z.a.leaveChatRoom,addCommonAlert:X.a.addCommonAlert,fetchUnreadedMessages:Z.a.fetchUnreadedMessages,markFailedMessages:Z.a.markFailedMessages},e)}}))(ee);t.default=te}}]);